# 🧪 じゃんけんアプリ デバッグガイド

このガイドでは、じゃんけんアプリの各種ケースをテストするためのデバッグ方法を説明します。

## 🎯 デバッグボタンの表示

デバッグ用ボタンは **開発モード（Debug Mode）** でのみ表示されます。
本番ビルドでは表示されません。

## 🚀 基本的なデバッグ手順

### 1. **アプリ起動**
```bash
cd client/game-app
flutter run
```

### 2. **デバッグボタンの確認**
- バトル画面のメイン画面に「🧪 デバッグ用テストケース」セクションが表示される
- 以下のボタンが利用可能：
  - 🟡 引き分けテスト
  - 🟢 勝利テスト
  - 🔴 敗北テスト
  - 🔵 連続引き分け
  - ⚪ 状態ログ
  - ⚫ 状態リセット

## 📋 テストケース一覧

### **基本勝敗パターン**
| パターン | 説明 | 期待される結果 |
|---------|------|----------------|
| グー vs チョキ | グーの勝ち | 勝利画面表示 |
| チョキ vs パー | チョキの勝ち | 勝利画面表示 |
| パー vs グー | パーの勝ち | 勝利画面表示 |

### **引き分けパターン**
| パターン | 説明 | 期待される結果 |
|---------|------|----------------|
| グー vs グー | 引き分け | 引き分け画面表示 → 3秒後に手選択画面 |
| チョキ vs チョキ | 引き分け | 引き分け画面表示 → 3秒後に手選択画面 |
| パー vs パー | 引き分け | 引き分け画面表示 → 3秒後に手選択画面 |

### **連続引き分けパターン**
| パターン | 説明 | 期待される結果 |
|---------|------|----------------|
| グー vs グー → グー vs グー → グー vs チョキ | 2回引き分け → 勝敗決定 | 引き分け×2 → 勝利画面 |
| パー vs パー → チョキ vs チョキ → パー vs グー | 2回引き分け → 勝敗決定 | 引き分け×2 → 勝利画面 |

### **エッジケースパターン**
| パターン | 説明 | 期待される結果 |
|---------|------|----------------|
| 手送信タイムアウト | 片方のみ手送信 → 相手待ち | タイムアウトエラー表示 |
| 対戦中接続断 | 手選択中 → 接続断 → 再接続 | 再接続処理実行 |
| 対戦辞退 | 手選択中 → 対戦辞退 | 辞退確認ダイアログ |

## 🔍 デバッグ実行手順

### **1. 引き分けテスト**
1. 「引き分けテスト」ボタンをタップ
2. 引き分け結果画面が表示されることを確認
3. 「3秒後に次のラウンドに進みます...」メッセージを確認
4. 3秒後に手選択画面に戻ることを確認

### **2. 勝利テスト**
1. 「勝利テスト」ボタンをタップ
2. 勝利結果画面が表示されることを確認
3. 「🎉 勝利！」メッセージを確認
4. 対戦結果の詳細が正しく表示されることを確認

### **3. 敗北テスト**
1. 「敗北テスト」ボタンをタップ
2. 敗北結果画面が表示されることを確認
3. 「😢 敗北...」メッセージを確認
4. 対戦結果の詳細が正しく表示されることを確認

### **4. 連続引き分けテスト**
1. 「連続引き分け」ボタンをタップ
2. 1回目の引き分け画面が表示されることを確認
3. 3秒後に手選択画面に戻ることを確認
4. 4秒後に2回目の引き分け画面が表示されることを確認

### **5. 状態ログ確認**
1. 「状態ログ」ボタンをタップ
2. コンソールに現在の状態が出力されることを確認
3. 各フラグの値が期待通りになっているか確認

### **6. 状態リセット**
1. 「状態リセット」ボタンをタップ
2. 全ての状態が初期値に戻ることを確認
3. メイン画面に戻ることを確認

## 🐛 よくある問題と対処法

### **問題1: 引き分け画面が表示されない**
**原因**: `_showingDrawResult`フラグが正しく設定されていない
**対処法**: 
- 「状態ログ」ボタンでフラグの値を確認
- `_handleDraw`メソッドの呼び出しを確認

### **問題2: 3秒後に画面が切り替わらない**
**原因**: タイマーが正しく動作していない
**対処法**:
- `_drawResultTimer`の設定を確認
- `_goToNextRound`メソッドの呼び出しを確認

### **問題3: 状態が正しく更新されない**
**原因**: `notifyListeners()`の呼び出しが不足
**対処法**:
- 各状態変更後に`notifyListeners()`が呼ばれているか確認
- コンソールログで状態変化を追跡

## 📱 実際のWebSocket接続でのテスト

### **1. サーバー起動**
```bash
cd server
docker-compose up -d
```

### **2. テストユーザーでのログイン**
1. テストユーザー1でログイン
2. WebSocket接続を確立
3. マッチング開始

### **3. 対戦相手との実際の対戦**
1. テストユーザー2で別のブラウザ/タブでログイン
2. 両者でマッチング開始
3. 対戦成立後、同じ手を選択して引き分けを発生
4. 引き分け処理の動作を確認

## 🔧 デバッグ用コードの場所

### **BattleProvider**
- `client/game-app/lib/providers/battle_provider.dart`
- デバッグ用メソッド: `debugSimulateDraw()`, `debugSimulateWin()` など

### **BattlePage**
- `client/game-app/lib/pages/battle/battle_page.dart`
- デバッグ用ボタンのUI実装

### **テストケース定義**
- `client/game-app/lib/utils/debug_test_cases.dart`
- 各種テストパターンの定義

## 📊 デバッグ結果の記録

テスト実行時は以下の情報を記録してください：

1. **テスト日時**: YYYY-MM-DD HH:MM:SS
2. **テストケース**: 実行したテストの名前
3. **期待される結果**: どのような動作を期待したか
4. **実際の結果**: 実際にどのような動作をしたか
5. **問題点**: 発見した問題や不具合
6. **修正内容**: 実施した修正内容
7. **再テスト結果**: 修正後のテスト結果

## 🎉 デバッグ完了の確認

以下の項目が全て正常に動作することを確認してください：

- [ ] 引き分け画面が正しく表示される
- [ ] 3秒後に自動的に手選択画面に戻る
- [ ] 連続引き分けが正しく処理される
- [ ] 勝敗結果が正しく表示される
- [ ] 状態管理が適切に動作する
- [ ] エラーハンドリングが正常に動作する

## 🚨 注意事項

1. **デバッグボタンは開発時のみ使用**
2. **本番環境では絶対に使用しない**
3. **テスト実行前は必ず状態をリセット**
4. **問題発見時は即座にログに記録**
5. **修正後は必ず再テストを実行**

このガイドに従って、じゃんけんアプリの各種ケースを徹底的にテストしてください！
