<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 じゃんけんバトル - WebSocket + Redis対応版</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎮 じゃんけんバトル - WebSocket + Redis対応版</h1>
            <div style="background: rgba(102, 126, 234, 0.1); padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 14px;">
                <strong>🆕 WebSocket + Redis対応版:</strong> 安定した接続、オフラインメッセージ、統計管理
            </div>
            <div class="user-info" id="userInfo">
                <span id="userDisplay">未ログイン</span>
                <button id="logoutBtn" class="btn btn-secondary" style="display: none;">ログアウト</button>
            </div>
        </header>

        <!-- ログイン画面 -->
        <div id="loginSection" class="section">
            <h2>🔐 ログイン</h2>
            
            <!-- 環境設定 -->
            <div class="config-section" style="background: #e3f2fd; border: 1px solid #90caf9; border-radius: 5px; padding: 15px; margin-bottom: 20px;">
                <h3>🔧 環境設定</h3>
                <div class="form-group">
                    <label for="apiBaseUrl">APIベースURL:</label>
                    <select id="apiBaseUrl">
                        <option value="http://192.168.0.150">開発環境 (Nginx経由 - 192.168.0.150:80)</option>
                        <option value="http://192.168.0.150:3000">開発環境 (直接 - 192.168.0.150:3000)</option>
                        <option value="http://localhost">開発環境 (Nginx経由 - localhost:80)</option>
                        <option value="http://localhost:3000">開発環境 (直接 - localhost:3000)</option>
                        <option value="http://192.168.1.180">開発環境 (Nginx経由 - 192.168.1.180:80)</option>
                        <option value="http://192.168.1.180:3000">開発環境 (直接 - 192.168.1.180:3000)</option>
                        <option value="http://160.251.137.105">VPS環境</option>
                        <option value="https://avwnok61nj.execute-api.ap-northeast-3.amazonaws.com/proc">AWS環境</option>
                        <option value="custom">カスタム</option>
                    </select>
                </div>
                <div class="form-group" id="customUrlGroup" style="display: none;">
                    <label for="customUrl">カスタムURL:</label>
                    <input type="text" id="customUrl" placeholder="http://localhost:8000" />
                </div>
                <button class="btn btn-success" onclick="updateApiBaseUrl()">設定更新</button>
                <div style="margin-top: 10px; padding: 8px; background: #fff3cd; border-radius: 3px; font-size: 12px;">
                    ⚠️ 現在の設定: <span id="currentApiUrl">192.168.0.150</span>
                </div>
            </div>
            
            <!-- ログインオプション -->
            <div class="login-options">
                <div class="login-method">
                    <h3>テストユーザーログイン（WebSocket + Redis対応版）</h3>
                    <div class="dev-login">
                        <select id="devUserSelect">
                            <option value="">テストユーザーを選択</option>
                            <option value="1">テストユーザー1 (test_user_1)</option>
                            <option value="2">テストユーザー2 (test_user_2)</option>
                            <option value="3">テストユーザー3 (test_user_3)</option>
                            <option value="4">テストユーザー4 (test_user_4)</option>
                            <option value="5">テストユーザー5 (test_user_5)</option>
                        </select>
                        <button id="devLoginBtn" class="btn btn-primary">WebSocket + Redis対応版でログイン</button>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 3px; font-size: 12px;">
                        💡 WebSocket + Redis対応版で安定した接続、オフラインメッセージ、統計管理
                    </div>
                </div>
                

            </div>
        </div>

        <!-- バトル画面 -->
        <div id="battleSection" class="section" style="display: none;">
            <!-- 接続状態 -->
            <div class="connection-status">
                <div class="status-indicator" id="connectionStatus">
                    <span class="status-dot offline"></span>
                    <span id="statusText">未接続</span>
                </div>
                <button id="connectBtn" class="btn btn-primary">接続</button>
                <button id="disconnectBtn" class="btn btn-secondary" style="display: none;">切断</button>
            </div>

            <!-- 対戦状態表示 -->
            <div class="battle-status" id="battleStatus">
                <h2 id="statusTitle">対戦待機中</h2>
                <p id="statusMessage">WebSocketに接続してマッチングを開始してください</p>
            </div>

            <!-- マッチング情報 -->
            <div id="matchingInfo" class="info-box" style="display: none;">
                <h3>🔍 マッチング中...</h3>
                <p>キュー位置: <span id="queuePosition">-</span></p>
                <p>推定待ち時間: <span id="estimatedWait">-</span>秒</p>
                <button id="cancelMatchingBtn" class="btn btn-danger">マッチングキャンセル</button>
            </div>

            <!-- 対戦相手情報 -->
            <div id="opponentInfo" class="info-box" style="display: none;">
                <h3>👤 対戦相手</h3>
                <div class="opponent-display">
                    <div id="opponentAvatar" class="avatar">👤</div>
                    <div class="opponent-details">
                        <p><strong id="opponentName">-</strong></p>
                        <p>ID: <span id="opponentId">-</span></p>
                    </div>
                </div>
                <button id="readyBtn" class="btn btn-success" style="display: none;">準備完了</button>
            </div>

            <!-- 手選択エリア -->
            <div id="handSelection" class="hand-selection" style="display: none;">
                <h3>✋ 手を選択してください</h3>
                <div class="hands">
                    <button class="hand-btn" data-hand="rock">
                        <span class="hand-emoji">✊</span>
                        <span class="hand-name">グー</span>
                    </button>
                    <button class="hand-btn" data-hand="scissors">
                        <span class="hand-emoji">✌️</span>
                        <span class="hand-name">チョキ</span>
                    </button>
                    <button class="hand-btn" data-hand="paper">
                        <span class="hand-emoji">✋</span>
                        <span class="hand-name">パー</span>
                    </button>
                </div>
                <p id="handStatus">手を選択してください</p>
            </div>

            <!-- バトル結果 -->
            <div id="battleResult" class="result-display" style="display: none;">
                <h3 id="resultTitle">結果</h3>
                <div class="battle-hands">
                    <div class="player-result">
                        <h4>あなた</h4>
                        <div class="hand-display" id="yourHand">-</div>
                        <div class="result-badge" id="yourResult">-</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="player-result">
                        <h4>相手</h4>
                        <div class="hand-display" id="opponentHand">-</div>
                        <div class="result-badge" id="opponentResult">-</div>
                    </div>
                </div>
                <div class="result-actions">
                    <button id="nextRoundBtn" class="btn btn-primary" style="display: none;">次のラウンド</button>
                    <button id="newBattleBtn" class="btn btn-success" style="display: none;">新しい対戦</button>
                    <button id="quitBattleBtn" class="btn btn-danger">対戦終了</button>
                </div>
            </div>

            <!-- アクションボタン -->
            <div class="action-buttons">
                <button id="startMatchingBtn" class="btn btn-primary">マッチング開始</button>
                <button id="debugResetBtn" class="btn btn-warning">デバッグ: 状態リセット</button>
            </div>
            
            <!-- 統計・ランキングボタン -->
            <div class="stats-buttons" style="margin-top: 15px; text-align: center;">
                <button id="loadStatsBtn" class="btn btn-secondary">統計更新 (Redis対応版)</button>
                <button id="loadRankingBtn" class="btn btn-secondary">ランキング表示 (Redis対応版)</button>
                <button id="getOfflineMessagesBtn" class="btn btn-info">オフラインメッセージ取得</button>
            </div>
        </div>

        <!-- ログ表示 -->
        <div class="log-section">
            <h3>📋 ログ</h3>
            <div id="logContainer">
                <div class="log-controls">
                    <button id="clearLogBtn" class="btn btn-secondary">ログクリア</button>
                    <label>
                        <input type="checkbox" id="autoScrollLog" checked> 自動スクロール
                    </label>
                </div>
                <div id="logMessages"></div>
            </div>
        </div>
    </div>

    <script src="battle.js"></script>
</body>
</html>